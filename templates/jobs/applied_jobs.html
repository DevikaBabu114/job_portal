{% extends 'base.html' %}

{% block title %}My Applications | JobPortal{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 30px;">
        <h1 style="margin: 0;"><i class="fas fa-file-alt"></i> My Applications</h1>
        <a href="{% url 'find_jobs' %}" style="background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
            <i class="fas fa-search"></i> Find More Jobs
        </a>
    </div>

    <!-- Application Statistics -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
        <div style="background: #007bff; color: white; padding: 20px; border-radius: 8px; text-align: center;">
            <h3 style="margin: 0; font-size: 2rem;">{{ applications|length }}</h3>
            <p style="margin: 0;">Total Applications</p>
        </div>
        <div style="background: #28a745; color: white; padding: 20px; border-radius: 8px; text-align: center;">
            <h3 style="margin: 0; font-size: 2rem;">{{ applications_by_status.applied|length }}</h3>
            <p style="margin: 0;">Applied</p>
        </div>
        <div style="background: #ffc107; color: black; padding: 20px; border-radius: 8px; text-align: center;">
            <h3 style="margin: 0; font-size: 2rem;">{{ applications_by_status.shortlisted|length }}</h3>
            <p style="margin: 0;">Shortlisted</p>
        </div>
        <div style="background: #17a2b8; color: white; padding: 20px; border-radius: 8px; text-align: center;">
            <h3 style="margin: 0; font-size: 2rem;">{{ applications_by_status.hired|length }}</h3>
            <p style="margin: 0;">Hired</p>
        </div>
    </div>

    <!-- Applications by Status -->
    {% for status, status_applications in applications_by_status.items %}
        {% if status_applications %}
        <div style="margin-bottom: 40px;">
            <h3 style="color: #333; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eaeaea;">
                {% if status == 'applied' %}
                    <i class="fas fa-clock text-primary"></i> Applied ({{ status_applications|length }})
                {% elif status == 'viewed' %}
                    <i class="fas fa-eye text-info"></i> Viewed ({{ status_applications|length }})
                {% elif status == 'shortlisted' %}
                    <i class="fas fa-star text-warning"></i> Shortlisted ({{ status_applications|length }})
                {% elif status == 'rejected' %}
                    <i class="fas fa-times-circle text-danger"></i> Rejected ({{ status_applications|length }})
                {% elif status == 'hired' %}
                    <i class="fas fa-check-circle text-success"></i> Hired ({{ status_applications|length }})
                {% endif %}
            </h3>
            
            <div style="display: grid; gap: 20px;">
                {% for application in status_applications %}
                <div style="border: 1px solid #eaeaea; border-radius: 10px; padding: 20px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 5px 0; color: #333;">
                                <a href="{% url 'job_detail' application.job.id %}" style="color: inherit; text-decoration: none;">
                                    {{ application.job.title }}
                                </a>
                            </h4>
                            <p style="margin: 0 0 5px 0; color: #007bff; font-weight: 500;">
                                {{ application.job.employer.company_name }}
                            </p>
                            <p style="margin: 0; color: #666;">
                                <i class="fas fa-map-marker-alt"></i> {{ application.job.location }} â€¢ 
                                <i class="fas fa-briefcase"></i> {{ application.job.get_job_type_display }}
                            </p>
                        </div>
                        <div style="text-align: right;">
                            <span style="background: 
                                {% if status == 'applied' %}#007bff
                                {% elif status == 'viewed' %}#17a2b8
                                {% elif status == 'shortlisted' %}#ffc107
                                {% elif status == 'rejected' %}#dc3545
                                {% elif status == 'hired' %}#28a745
                                {% endif %}; 
                                color: {% if status == 'shortlisted' %}black{% else %}white{% endif %}; 
                                padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 500;">
                                {{ application.get_status_display }}
                            </span>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 0.9rem;">
                                Applied: {{ application.applied_date|date:"M j, Y" }}
                            </p>
                        </div>
                    </div>
                    
                    {% if application.cover_letter %}
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <h5 style="margin: 0 0 10px 0; color: #333;">Your Cover Letter</h5>
                        <p style="margin: 0; color: #666; line-height: 1.5;">
                            {{ application.cover_letter|truncatewords:50 }}
                        </p>
                    </div>
                    {% endif %}
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <a href="{% url 'job_detail' application.job.id %}" 
                           style="padding: 8px 16px; border: 1px solid #007bff; color: #007bff; text-decoration: none; border-radius: 5px; font-size: 0.9rem;">
                            View Job
                        </a>
                        {% if application.cover_letter %}
                        <button type="button" 
                                onclick="showCoverLetter('{{ application.cover_letter|escapejs }}')"
                                style="padding: 8px 16px; border: 1px solid #6c757d; color: #6c757d; background: none; border-radius: 5px; font-size: 0.9rem; cursor: pointer;">
                            View Full Cover Letter
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    {% endfor %}

    {% if not applications %}
    <div style="text-align: center; padding: 60px 20px;">
        <i class="fas fa-file-alt" style="font-size: 4rem; color: #ddd; margin-bottom: 20px;"></i>
        <h3 style="color: #666; margin-bottom: 15px;">No Applications Yet</h3>
        <p style="color: #999; margin-bottom: 30px;">You haven't applied to any jobs yet. Start your job search today!</p>
        <a href="{% url 'find_jobs' %}" style="background: #007bff; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; font-weight: 500;">
            <i class="fas fa-search"></i> Find Jobs
        </a>
    </div>
    {% endif %}
</div>

<!-- Cover Letter Modal -->
<div id="coverLetterModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">Cover Letter</h3>
            <button onclick="closeCoverLetter()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
        </div>
        <div id="coverLetterContent" style="line-height: 1.6; color: #333;"></div>
        <div style="margin-top: 20px; text-align: right;">
            <button onclick="closeCoverLetter()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Close
            </button>
        </div>
    </div>
</div>

<style>
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

@media (max-width: 768px) {
    .container {
        padding: 15px;
    }
    
    div[style*="grid-template-columns"] {
        grid-template-columns: 1fr 1fr !important;
    }
    
    div[style*="display: flex; justify-content: between"] {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    div[style*="display: flex; justify-content: between; align-items: start"] {
        flex-direction: column;
        gap: 15px;
    }
    
    div[style*="text-align: right"] {
        text-align: left !important;
        width: 100%;
    }
}
</style>

<script>
function showCoverLetter(content) {
    document.getElementById('coverLetterContent').innerHTML = content.replace(/\n/g, '<br>');
    document.getElementById('coverLetterModal').style.display = 'flex';
}

function closeCoverLetter() {
    document.getElementById('coverLetterModal').style.display = 'none';
}

// Close modal when clicking outside
document.getElementById('coverLetterModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeCoverLetter();
    }
});
</script>
{% endblock %}